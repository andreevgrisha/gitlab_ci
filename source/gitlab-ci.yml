image: docker:latest

stages:
  - testing
  - packing
  - uploading  
  - checking

variables:
  IMAGE: gr.io:8089/testwebapp

test:
  stage: testing
  script: cat index.html | grep '<title>WebApp</title>'

build:
  stage: packing
  script:
    - docker build -t $IMAGE .

upload:
  stage: uploading
  script:
    - docker login -u runner -p "$NEXUS_PASS" gr.io:8089
    - docker push $IMAGE

check:
  stage: checking
  script:
    - docker login -u runner -p "$NEXUS_PASS" gr.io:8089
    - docker pull $IMAGE

